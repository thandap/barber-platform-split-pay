<!DOCTYPE html>
<html>
<head>
    <title>Multi-Stylist Payment + Tip</title>
    <script src="https://js.stripe.com/v3/"></script>
    <head>
        <title>Multi-Stylist Payment + Tip</title>

        <!-- ðŸ”§ Add this here -->
        <style>
            #card-element {
                border: 1px solid #ccc;
                padding: 10px;
                border-radius: 6px;
                max-width: 400px;
                margin-top: 10px;
            }

            form {
                max-width: 450px;
                margin: 0 auto;
                font-family: sans-serif;
            }

            input {
                margin-bottom: 10px;
                padding: 8px;
                width: 100%;
                box-sizing: border-box;
            }

            button {
                padding: 10px 15px;
                background-color: #2c7be5;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }

                button:hover {
                    background-color: #1a5fb4;
                }

            #card-errors {
                color: red;
                margin-top: 8px;
            }
        </style>

        <!-- Stripe script -->
        <script src="https://js.stripe.com/v3/"></script>
    </head>

</head>
<body>
    <h2>Pay for Two Haircuts + Tips</h2>

    <form id="payment-form">
        <label>Stylist A ID: <input id="stylistA" value="acct_XXXXA" /></label><br />
        <label>Tip for Stylist A ($): <input id="tipA" value="5" /></label><br /><br />

        <label>Stylist B ID: <input id="stylistB" value="acct_XXXXB" /></label><br />
        <label>Tip for Stylist B ($): <input id="tipB" value="10" /></label><br /><br />

        <div id="card-element"></div><br />
        <button type="submit">Pay Now</button>
    </form>

    <script>
        const stripe = Stripe("pk_test_XXXXXXXXXXXXXXXXXXXX"); // your publishable key

        document.getElementById("payment-form").addEventListener("submit", async (e) => {
            e.preventDefault();

            const stylistA = document.getElementById("stylistA").value;
            const stylistB = document.getElementById("stylistB").value;
            const tipA = parseFloat(document.getElementById("tipA").value) || 0;
            const tipB = parseFloat(document.getElementById("tipB").value) || 0;

            const serviceAmount = 30 + 30; // two $30 services
            const totalAmount = serviceAmount + tipA + tipB;

            const response = await fetch("/create-payment-intent", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ stylistA, stylistB, tipA, tipB })
            });

            const { clientSecret, paymentIntentId } = await response.json();

            const elements = stripe.elements();
            const card = elements.create("card");
            card.mount("#card-element");

            const result = await stripe.confirmCardPayment(clientSecret, {
                payment_method: { card: card }
            });

            if (result.error) {
                alert("Payment failed: " + result.error.message);
            } else {
                await fetch("/confirm-transfers", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ paymentIntentId, stylistA, stylistB, tipA, tipB })
                });

                alert("ðŸ’¸ Payment and tips sent to both stylists!");
            }
        });
    </script>
</body>
</html>
