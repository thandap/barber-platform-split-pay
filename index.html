<!DOCTYPE html>
<html>
<head>
    <title>Barber Split Pay Demo</title>
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <h2>Pay $60 - Split to Two Stylists</h2>
    <form id="payment-form">
        <div id="card-element"></div>
        <button type="submit">Pay $60</button>
    </form>

    <script>
        const stripe = Stripe("pk_test_51RLQeoCVVPDhAwrvywntXX5VX0yOOmxFOUNyNxuiPcXGKoZtTeRkE4lqW5scgYmiu20dOrZgwTTvWR0WaoU3UNSE00aTaujuEx"); // your publishable key
        let paymentIntentId, stylistA, stylistB;

        fetch("/create-payment-intent", {
            method: "POST",
            headers: { "Content-Type": "application/json" }
        })
            .then(res => res.json())
            .then(data => {
                paymentIntentId = data.clientSecret.split('_secret')[0];
                stylistA = data.stylistA;
                stylistB = data.stylistB;

                const elements = stripe.elements();
                const card = elements.create("card");
                card.mount("#card-element");

                document.getElementById("payment-form").addEventListener("submit", async (e) => {
                    e.preventDefault();
                    const result = await stripe.confirmCardPayment(data.clientSecret, {
                        payment_method: { card }
                    });

                    if (result.error) {
                        alert("Payment failed: " + result.error.message);
                    } else {
                        fetch("/confirm-transfers", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ paymentIntentId, stylistA, stylistB })
                        })
                            .then(res => res.json())
                            .then(() => alert("ðŸ’¸ Payment and split successful!"));
                    }
                });
            });
    </script>
</body>
</html>
